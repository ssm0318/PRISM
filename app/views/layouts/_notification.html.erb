<% if user_signed_in? %>
    <% if noties.unread.length != 0 %>
        <%=image_tag "icons/noti-on-icon.png", class:"btn-noti hover-pointer"%>
    <% else %>
        <%=image_tag "icons/noti-default-icon.png", class:"btn-noti hover-pointer"%>
    <% end %>
<% end %>
<div class="noti-content" style="display: none;">
    <% if user_signed_in? %>
        <% noties.each do |noti| %>
            <% user = User.find(noti.actor_id)%>
            <% username = user.username %>

            <% if noti.read_at != nil %>
                <div class="noti-el" onclick="window.location='/notifications/<%=noti.id%>'">
            <% else %>
                <div class="noti-el unread" onclick="window.location='/notifications/<%=noti.id%>'">
            <% end %>

                <% case noti.target_type%>
                <% when 'Friendship' %>
                    <%=username%>님과 친구가 되었습니다.
                <% when 'Answer' %>
                    <%=username%>님이 당신이 보낸 질문에 답했습니다.
                <% when 'Assignment' %>
                    <%=username%>님으로부터 새로운 질문이 도착했습니다.
                <% when 'Highlight' %>
                    <%=username%>님이 당신의 글을 highlight했습니다.
                <% when 'Drawer' %>
                    <% if noti.origin.drawers.size == 1 %>
                        <%# if noti.origin_type == 'Question' %>
                            <%# 당신의 질문이 누군가의 서랍장에 담겼습니다. %>
                        <%# else %>
                            당신의 글이 누군가의 서랍장에 담겼습니다.
                        <%# end %>
                    <% else %>
                        <%# if noti.origin_type == 'Question' %>
                            <!-- <%= noti.origin.drawers.size %>명이 당신의 질문을 서랍장에 담았습니다.-->
                        <%# else %>
                            <%= noti.origin.drawers.size %>명이 당신의 글을 서랍장에 담았습니다.
                        <%# end %>
                    <% end %>
                <% when 'Comment' %>
                    <% if noti.action == 'friend_comment' %>
                        <%=username%>님이 당신의 글에 댓글을 달았습니다.
                    <% elsif noti.action == 'anonymous_comment'%> 
                        누군가가 당신의 글에 댓글을 달았습니다.
                    <% end %>
                <% when 'Reply' %>
                    <% case noti.action %>
                    <% when 'anonymous_to_comment'%>
                        누군가가 당신의 댓글에 대댓글을 달았습니다.
                    <% when 'anonymous_to_author'%>
                        누군가가 당신의 글에 대댓글을 달았습니다.
                    <% when 'friend_to_comment' %>
                        <%= username %>님이 당신의 댓글에 대댓글을 달았습니다.
                    <% when 'friend_to_author' %>
                        <%= username %>님이 당신의 글에 대댓글을 달았습니다.
                    <% else %>
                    <% end %>
                <% when 'FriendRequest'%>
                    <%=username%>님이 친구요청을 보냈습니다.
                <% when 'Like' %>
                    <% if noti.origin.likes.size == 1 %>
                        <% case noti.action %>
                        <% when 'friend_like_article' %>
                            <%=username%>님이 당신의 글을 좋아했습니다.
                        <% when 'friend_like_comment' %>
                            <%=username%>님이 당신의 댓글을 좋아했습니다: "<%= noti.target.target.content %>"
                        <% when 'friend_like_reply'%>
                            <%= username %>님이 당신의 대댓글을 좋아했습니다: "<%= noti.target.target.content %>"
                        <% when 'anonymous_like_article' %>
                            누군가가 당신의 글을 좋아했습니다.
                        <% when 'anonymous_like_comment' %>
                            누군가가 당신의 댓글을 좋아했습니다: "<%= noti.target.target.content %>"
                        <% when 'anonymous_like_reply' %>
                            누군가가 당신의 대댓글을 좋아했습니다: "<%= noti.target.target.content %>"
                        <% else %>
                        <% end %>
                    <% else %>
                        <% case noti.action %>
                        <% when 'friend_like_article' %>
                            <%= username %>님 외 <%= noti.origin.likes.size-1 %>명이 당신의 글을 좋아했습니다. 
                        <% when 'friend_like_comment' %>
                            <%= username %>님 외 <%= noti.origin.likes.size-1 %>명이 당신의 댓글을 좋아했습니다: "<%= noti.target.target.content %>" 
                        <% when 'friend_like_reply' %>
                            <%= username %>님 외 <%= noti.origin.likes.size-1 %>명이 당신의 대댓글을 좋아했습니다: "<%= noti.target.target.content %>"
                        <% when 'anonymous_like_article' %>
                            <%= noti.origin.likes.size %>명이 당신의 글을 좋아했습니다.
                        <% when 'anonymous_like_comment' %>
                            <%= noti.origin.likes.size %>명이 당신의 댓글을 좋아했습니다: "<%= noti.target.target.content %>"
                        <% when 'anonymous_like_reply' %>
                            <%= noti.origin.likes.size %>명이 당신의 대댓글을 좋아했습니다: "<%= noti.target.target.content %>"
                        <% else %>
                        <% end %>
                    <% end %>   
                <% when 'Announcement' %>
                    어도어에 새로운 공지가 있습니다.
                <% else %>  
                <% end %>
                <div class = "date time" style="display: block; margin-top: 5px; font-size: 10px;"><%= time_tag noti.updated_at, class: "timeago" %></div> 
            </div>
        <% end %>
    <% end %>
</div>

<script>
    $(document).ready(function() {
        $(".btn-noti").on('click', function() {
            $(".noti-content").toggle();
        })

        $("html").on('click', function(event) {
            var target = $(event.target)
            if(!target.hasClass("btn-noti") &&
            !target.hasClass("noti-content") &&
            !target.hasClass("noti-el")) {
                $(".noti-content").hide();
            }
        });
    })
</script>
