<script>
  $(document).ready(function() {

    $("form").submit( function(e) {

        e.preventDefault();

        var form = $(this)
        $.ajax({
          type: "POST",
          url: form.attr('action'),
          
          data: form.serialize(),
          success: function(data) {
           
            if(form.hasClass("comment")) {

              var html = $(`
              <div class='comment-replies-form'>
                <div class='comment-replies'>
                  <div class='comment'>
                    <div class='comment-content'>
                      <span>
                        <img src='${data.imageurl}' 
                          alt='' class='user-profile'>
                        <a href='${data.path}' class='username'>
                          ${data.username}
                        </a>
                        <span class="content">
                          ${data.content}
                        </span> 
                      </span>
                    </div> 
                  </div>
                </div>
                <form action='/answers/comment/${data.comment_id}/reply' method='POST' class="prism-form reply" >
                    <input class="prism-form__input" type="text" name="content">
                    <input type="submit" class="prism-form__button">
                </form>
              </div>
              `)

              form.parent().find(".anonymous-comments-div").append(html)

              ///////// 동적으로 삽입한 form에 다시 event binding 해줌. 하나만 선택해야됨.
              html.find("form").submit( function(event) {

                var newform = $(this)

                event.preventDefault();
                $.ajax({
                  type: "POST",
                  url: newform.attr('action'),
                  data: newform.serialize(),
                  success: function(data) {
                    var newhtml =
                      `
                        <div class='reply'>
                          <div class="comment-content">
                            <span>
                              <img src='${data.imageurl}' 
                                alt='' class='user-profile'>
                              <a href='${data.path}' class='username'>
                                ${data.username}
                              </a>
                              <span class="content">
                                ${data.content}
                              </span> 
                            </span>
                          </div> 
                        </div>
                      `
                    newform.parent().find(".comment-replies").append(newhtml);
                    newform.find(".prism-form__input").val('')
                  },
                  error: function(data) {
                    console.log("error")
                  }
                })
              })

            }
            else {
              var html =
              `
                <div class='reply'>
                  <div class="comment-content">
                    <span>
                      <img src='${data.imageurl}' 
                        alt='' class='user-profile'>
                      <a href='${data.path}' class='username'>
                        ${data.username}
                      </a>
                      <span class="content">
                        ${data.content}
                      </span> 
                    </span>
                  </div> 
                </div>
              `
              form.parent().find(".comment-replies").append(html)
            
            }
            form.find(".prism-form__input").val('')
          },
          error: function(data) {
              console.log("error")
          }
        })
    })

  })
</script>