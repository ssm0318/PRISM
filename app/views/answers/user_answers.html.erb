<h1>User Answers Page</h1>
<%= render partial: "./user_answers_layout", locals: {user: @user} %>

<div>
    <% @answers.each do |a| %>
        <div style='border: 1px solid black; margin: 5px;'>
            <%= render partial: "./user_profile", locals: {user: a.author} %><br/>
            <% if current_user.id == @user.id %>
                <%= link_to "수정하기", edit_answer_path(a.id) %>
                <%= link_to "삭제하기", answer_path(a.id),
                                      method: :delete,
                                      data: { confirm: '답변을 지우시겠습니까?'} %> 
                <%# TODO: 공개범위 수정하는거 구현 %> 
                <br/>
            <% end %>
            <%= a.created_at %><br/>
            Q: <%= a.question.content %>
            <% if Star.where(user_id: current_user.id, target: a.question).empty? %>
                <%= link_to "별표하기", stars_path(target_id: a.question.id, target_type: "Question"), method: :post %>
            <% else %>
                <%= link_to "별표 취소하기", star_path(a.question.id, target_type: "Question"), method: :delete %>
            <% end %>
            <br/>
            A: <%= a.content %><br/>
            <%# 여기도. 이런 코드를 view에서 쓰는 게 맞는지 %>
            <% if Star.where(user_id: current_user.id, target: a).empty? %>
                <%= link_to "별표하기", stars_path(target_id: a.id, target_type: "Answer"), method: :post %>
            <% else %>
                <%= link_to "별표 취소하기", star_path(a.id, target_type: "Answer"), method: :delete %>
            <% end %>
            <div>
                <% if current_user.id == @user.id %>
                    <%= a.highlights.size %>개의 형광펜
                    <%= Star.where(target_type: "Answer", target_id: a.id).size %>명이 별표함
                    <%= a.comments.size %>개의 댓글 <br/>
                    <div>
                        댓글 <br/>
                        <% a.comments.each do |c| %>
                            <%= render partial: "./user_profile", locals: {user: c.author} %>: 
                            <%= c.content %> <br/>
                        <% end %>
                    </div>
                <% else %>
                    <div>
                        내가 쓴 댓글 <br/>
                        <% a.comments.each do |c| %>
                            <% if c.author.id == current_user.id %>
                                <%= render partial: "./user_profile", locals: {user: c.author} %>: 
                                <%= c.content %> <br/>
                            <% end %>
                        <% end %>
                    </div>
                <% end %>
            </div>
            <form data-answer_id="<%= a.id %>" data-recipient_id="<%= a.author.id %>">
                <input type="text" class="input<%= a.id %>" name="content ">
                <button>댓글 달기</button>
            </form>
            </div>
        </div>
    <% end %>
</div>
