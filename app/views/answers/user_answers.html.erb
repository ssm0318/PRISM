

<div class="inner-container">
<%= render partial: "./user_answers_layout", locals: {user: @user} %>
    <% if !@user.friends.include? current_user %>
        <%= @user.username %>님과 친구가 되어보세요.
    <% else %>
        <% @answers.reverse_each do |a| %>
            <div class="prism-box">

                <div class="prism-box__header">
                    <%= render partial: "./user_profile", locals: {user: a.author} %><br/>
                    <!--
                    <% if current_user.id == @user.id %>
                        <%= link_to "수정하기", edit_answer_path(a.id) %>
                        <%= link_to "삭제하기", answer_path(a.id),
                                            method: :delete,
                                            data: { confirm: '답변을 지우시겠습니까?'} %> 
                        <%# TODO: 공개범위 수정하는거 구현 %> 
                        <br/>
                    <% end %>
                    -->
                    <!--
                    <% if current_user.id == @user.id %>
                            <%= a.highlights.size %> 개의 형광펜
                            <%= Star.where(target_type: "Answer", target_id: a.id).size %> 명이 별표함
                            <%= a.comments.size %> 개의 댓글 <br/><br>
                    <% end %>
                    -->
                </div>
                <div class="prism-box__content">
                    <br><div class="question" style="font-size: 18px;"><%= a.question.content %></div>
                    
                    <br/>
                    <div class="answer"><%= a.content %></div>
                    <%# 여기도. 이런 코드를 view에서 쓰는 게 맞는지 %>
                    <br><br>
                </div>
                <div class="prism-box__footer" style="padding-bottom: 10px;">
                    <%= a.created_at.strftime("%m월 %d일") %>
                    <!--
                    <% if Star.where(user_id: current_user.id, target: a.question).empty? %>
                        <%= link_to "<i class='material-icons'>star_border</i>".html_safe, stars_path(target_id: a.question.id, target_type: "Question"), method: :post %>
                    <% else %>
                        <%= link_to "<i class='material-icons'>star</i>".html_safe, star_path(a.question.id, target_type: "Question"), method: :delete %>
                    <% end %>
                    -->
                    <% if Star.where(user_id: current_user.id, target: a).empty? %>
                        <%= link_to "<i class='material-icons'>star_border</i>".html_safe, stars_path(target_id: a.id, target_type: "Answer"), method: :post %>
                    <% else %>
                        <%= link_to "<i class='material-icons'>star</i>".html_safe, star_path(a.id, target_type: "Answer"), method: :delete %>
                    <% end %>
                </div>

                <div class="prism-box__footer" style="margin-top: 5px; border-top: 1px dashed #d7dae0;">
                    <div>
                        <% if current_user.id == @user.id %>
                            <div>
                                댓글 <br/><br>
                                <% recipients = [] %>
                                <% a.comments.each do |c| %>
                                    <% recipients.push(c.recipient_id) %>
                                <% end %>
                                <% recipients.uniq! %>
                                <% recipients.each do |r| %>
                                    <div>
                                        <div class="comment-block">
                                            <% a.comments.each do |c| %>
                                                <div class="comment">
                                                    <% if c.recipient_id == r %>
                                                        <% if c.author_id == current_user.id %>
                                                            ㄴ<%#= render partial: "./user_profile", locals: {user: c.author} %> 
                                                            <%= image_tag c.author.image.url, :style => "height:20px; width:20px; border-radius:10px; margin-right: 2px;" %>
                                                            <%= link_to c.author.username, user_answers_path(c.author.id), class: "username" %>
                                                            <span style="vertical-align: +6px;">: <%= c.content %> <br/></span>
                                                        <% else %>
                                                            <%#= render partial: "./user_profile", locals: {user: c.author} %>
                                                            <%= image_tag c.author.image.url, :style => "height:20px; width:20px; border-radius:10px; margin-right: 2px;" %>
                                                            <%= link_to c.author.username, user_answers_path(c.author.id), class: "username" %>
                                                            <span style="vertical-align: +6px;">: <%= c.content %> <br/></span>
                                                        <% end %>
                                                    <% end %>
                                                </div>
                                            <% end %>
                                        </div>
                                        <form class="prism-form" action='/answers/<%= a.id %>/comments/<%= r %>' method='POST'>
                                            <input class="prism-form__input" type='text' name='content' />
                                            <button class="prism-form__button">댓글 달기</button>
                                        </form>
                                    </div>
                                <% end %>
                            </div>
                        <% else %>
                            <div>
                                내가 쓴 댓글 <br/><br>
                                <% a.comments.each do |c| %>
                                    <% if c.author.id == current_user.id %>
                                        <%= image_tag c.author.image.url, :style => "height:20px; width:20px; border-radius:10px; margin-right: 2px;" %>
                                        <%= link_to c.author.username, user_answers_path(c.author.id), class: "username" %>
                                        <%#= render partial: "./user_profile", locals: {user: c.author} %> 
                                        <span style="vertical-align: +6px;">: <%= c.content %></span> <br/>
                                    <% elsif c.author.id == a.author.id %>
                                        <%= image_tag c.author.image.url, :style => "height:20px; width:20px; border-radius:10px; margin-right: 2px;" %>
                                        <%= link_to c.author.username, user_answers_path(c.author.id), class: "username" %>
                                        ㄴ<%#= render partial: "./user_profile", locals: {user: c.author} %>
                                        <span style="vertical-align: +6px;">: <%= c.content %></span> <br/>
                                    <% end %>
                                <% end %>
                                <form action='/answers/<%= a.id %>/comments/<%= a.author.id %>' method='POST' class="prism-form" >
                                    <input class="prism-form__input" type="text" name="content">
                                    <button class="prism-form__button">댓글 달기</button>
                                </form>
                            </div>
                        <% end %>
                    </div>
                </div>
            </div>
        <% end %>
    <% end %>
</div>
