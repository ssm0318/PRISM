<% @user = @answer.author %>
<% answer = @answer %>
<% anonymous = @anonymous%>
<div class="inner-container">
<div class="prism-box">

    <div class="prism-box__header">
        <%# 익명글 %>
        <% if anonymous %>
            <%= render partial: "./user_profile_general", locals: {user_id: answer.author_id, answer_id: answer.id} %>
        <%# 친구글 or 내글 %>
        <%else %>
            <%= render partial: "./user_profile", locals: {user: answer.author} %>
        <% end %>
        <br/>
        
        <%
=begin%>
 <% if current_user.id == @user.id %>
            <%= link_to "수정하기", edit_answer_path(a.id) %>
            <%= link_to "삭제하기", answer_path(a.id),
                                method: :delete,
                                data: { confirm: '답변을 지우시겠습니까?'} %> 
            <%# TODO: 공개범위 수정하는거 구현 %> 
            <br/>
        <% end %>
        <% if current_user.id == @user.id %>
                <%#= Highlight.where(target_type: "Answer", target_id: a.id).size %> 개의 형광펜
                <%= Drawer.where(target_type: "Answer", target_id: a.id).size %> 명이 별표함
                <%= a.comments.size %> 개의 댓글 <br/><br>
        <% end %> 
<%
=end%>

    </div>
    <div class="prism-box__content">
        <br>
        <a href="/questions/<%=answer.question.id%>/friend" class="question"><%= answer.question.content %></a><br><br>
        <div class="answer"><%= answer.content %></div>
        <%# 여기도. 이런 코드를 view에서 쓰는 게 맞는지 %>
        <%
=begin%>
 <br>
        태그:
        <% if !a.tag_string.nil? %>
            <%= a.tag_string.gsub("\r\n", "\n").split("\n").join(", ") %>
        <% end %> 
<%
=end%>
        <div class = "date"><%= time_tag answer.updated_at, class: "timeago" %></div>
        <br>
    </div>
    <div class="prism-box__footer" style="padding-bottom: 10px;">
      
        <%# if Drawer.where(user_id: current_user.id, target: a.question).empty? %>
            <%#= link_to "<i class='material-icons'>star_border</i>".html_safe, drawerss_path(target_id: a.question.id, target_type: "Question"), method: :post %>
        <%# else %>
            <%#= link_to "<i class='material-icons'>star</i>".html_safe, drawer_path(a.question.id, target_type: "Question"), method: :delete %>
        <%# end %>
        <%# if Drawer.where(user_id: current_user.id, target: a).empty? %>
            <%#= link_to "<i class='material-icons'>star_border</i>".html_safe, drawers_path(target_id: a.id, target_type: "Answer"), method: :post %>
        <%# else %>
            <%#= link_to "<i class='material-icons'>star</i>".html_safe, drawer_path(a.id, target_type: "Answer"), method: :delete %>
        <%# end %>
      
        <%= render 'authorized_answer', a: answer %>
        <%= render 'like', a: answer, target_type: "Answer", like_btn_class: "btn-answer-like" %>
        <%= render 'drawer', a: answer %>
        <br>
    </div>
    <%# 익명글 %>
    <% if anonymous %>
        <%= render 'comment_general_form', answer: answer %>
    <%# 친구글 or 내글 %>
    <%else %>
        <%= render 'comment_form', user: answer.author, a: answer %>
    <% end %>
</div>

<%= render 'layouts/timestamp' %>
<%= render 'drawer_script' %>
<%# 익명글 %>
<% if anonymous %>
    <%= render 'comment_general_script'%>
<%# 친구글 or 내글 %>
<%else %>
    <%= render 'comment_script' %>
<% end %>
<%= render 'like_script' %>
<%= render 'delete_script' %>
<script>
  $(document).ready(function() {
    like_ajax($(".btn-answer-like"))
    like_ajax($(".btn-comment-like"))
    delete_ajax($(".btn-answer-delete"))
    delete_ajax($(".btn-comment-delete"))
  })
</script>