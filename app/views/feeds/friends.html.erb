<div class="inner-container">
  <div class="prism-box-new-post">
    <div class="prism-box__content">
      <div class = "posting-or-custom-question">
        <span class = "posting selected"> 포스팅 </span>
        <span class = "custom-question"> 질문 </span>
      </div>  
      <%= render 'posts/new'%>
      <%= render 'custom_questions/new'%>
    </div>
  </div>

  <%= render partial: 'feeds/friends_index', locals: {feeds: @feeds} %>
</div>

<script>
    check_channels($(".answer-button"))
    $(".feed-edit").on('click', function() {
      
      form = $(this)
      $.ajax({
        type: "GET",
        url: form.attr('data-url'),
        success: function(data) {

          var html = $(`${data.html_content}`)

          $("#edit-background").find("#edit-box").append(html)
          check_channels(html.find(".answer-button"))
          $("#edit-background").show()
          $("body").css('overflow', 'hidden')
          textarea_init($(html.find('textarea')), $("#edit-background"))

          //편집 exit 버튼
          $("#btn-edit-exit").on('click', function() {
            html.remove()
            $("#edit-background").hide()
            $("body").css('overflow', 'auto')
          })
          
          //편집 완료
          $(".edit_answer, .edit_post, .edit_custom_question").submit( function(e) {
            e.preventDefault()

            form = $(this)
            console.log(form)
            $.ajax({
              type: "PUT",
              url: form.attr('action'),
              data: form.serialize(),
              success: function(data) {
                console.log("successed")
                  $(`.prism-box.${data.id}`).find(".answer").html(form.find(".new-answer-field").val())
                  $(`.prism-box.${data.id}`).find(".feed-channels").html("공개범위: " + data.channels)
                  html.remove()
                  $("#edit-background").hide()
                  $("body").css('overflow', 'auto')
              },
              error: function(data) {
                  console.log("error!")
              }
            })
          })
        },
        error: function(data) {
            console.log("error!")
        }
      })
      
    })

</script>
<script>

  textarea_init($('#new-post-form').find("textarea"), window)
  textarea_init($('#new-custom-question-form').find("textarea"), window)
  $(".posting").on('click', function () {
    var selected = $(this);
    $(this).addClass("selected");
    $('.custom-question').removeClass("selected");
    $('#new-post-form').show();
    $('#new-custom-question-form').hide();
  })

  $(".custom-question").on('click', function () {
    var selected = $(this);
    $(this).addClass("selected");
    $('.posting').removeClass("selected");
    $('#new-custom-question-form').show();
    $('#new-post-form').hide();
  })
</script>


