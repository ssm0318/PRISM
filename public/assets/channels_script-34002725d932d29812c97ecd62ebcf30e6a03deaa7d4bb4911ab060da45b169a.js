function channel_edit_clear(){$("#channel-nav-div").removeClass("editing"),$(".friend-box").removeClass("value-changed"),$(".friend-box").removeClass("editing"),$(".friend-box-with-edit").removeClass("editing"),$("#name-edit-form").hide(),$("#name-create-form").hide(),$("#channel-default-btns").show(),$("#btn-channel-add").show(),$("#channel-name").show(),$(".btn-friend-remove").show(),$(".friend-box-invitation").hide()}function click_channel_nav(e){e.on("click",function(){if($("#channel-nav-div").hasClass("editing")&&channel_edit_clear(),$(".channel-nav").removeClass("active"),$(this).addClass("active"),$("#channel-name").html($(this).html()),$(".friend-box").removeClass("disabled"),$(".friend-box-with-edit").show(),$(this).hasClass("all"))$("#channel-default-btns").hide(),$(".friend-box-invitation").show();else{const n=$(this).attr("class").split(/\s+/)[1];$("#btn-channel-delete").attr("href",`/channels/${n}`),$("#channel-default-btns").show();var e=$(".friend-box").filter(function(){return!$(this).has("."+n).length});e.addClass("disabled"),e.parents(".friend-box-with-edit").hide(),$(".friend-box-invitation").hide()}})}click_channel_nav($(".channel-nav")),$("#btn-channel-edit").on("click",function(){$("#channel-nav-div").hasClass("editing")&&($("#name-create-form").hide(),$("#btn-channel-add").show()),$("#channel-nav-div").addClass("editing"),$(".friend-box-with-edit").addClass("editing"),$("#channel-nav-div").addClass("editing"),$(".friend-box-with-edit").show(),$("#channel-default-btns").hide(),$(".btn-friend-remove").hide(),$("#channel-name").hide(),$("#name-edit-input").val($("#channel-nav-div").find(".active").html().trim()),$("#name-edit-form").show(),$("#name-edit-input").focus()}),$("#name-edit-btn").on("click",function(){const e=$("#channel-nav-div").find(".active").attr("class").split(/\s+/)[1];var n=[];$(".value-changed").each(function(a,i){n.push($(i).attr("class").split(/\s+/)[1]),$(this).hasClass("disabled")?$(this).find("."+e).remove():$(this).append(`<span class="channel-id ${e}"></span>`)}),channel_edit_clear(),$(".friend-box.disabled").parents(".friend-box-with-edit").hide(),n.length>0&&$.ajax({type:"PUT",url:`/channels/${e}/edit_friendship`,data:{friend_ids:n},success:function(){console.log("successed!")},error:function(){console.log("error!")}})}),$(".friend-box-with-edit").on("click",function(){$(this).hasClass("editing")&&($(this).find(".friend-box").toggleClass("disabled"),$(this).find(".friend-box").toggleClass("value-changed"))}),$("#btn-channel-add").on("click",function(){$("#channel-nav-div").hasClass("editing")&&($(".value-changed").length>0&&$(".value-changed").toggleClass("disabled"),channel_edit_clear()),$("#channel-nav-div").addClass("editing"),$(this).hide(),$("#name-create-form").css("display","inline"),$("#name-create-input").focus()}),$("#name-edit-form, #name-create-form").submit(function(e){e.preventDefault();const n=$("#channel-nav-div").find(".active").attr("class").split(/\s+/)[1],a=$(this);let i=$(this).is("#name-edit-form")?"PUT":"POST",t=$(this).is("#name-edit-form")?`/channels/${n}`:"/channels";$.ajax({type:i,url:t,data:a.serialize(),success:function(e){if(console.log("successed!"),0==e.successed)a.is("#name-edit-form")?$("#name-edit-input").val(""):$("#name-create-input").val(""),alert(e.message);else{if(a.hide(),$("#channel-nav-div").removeClass("editing"),a.is("#name-edit-form"))$("#channel-name").html($("#name-edit-input").val()),$("#channel-nav-div").find(".active").html($("#name-edit-input").val());else{$("#channel-name").html($("#name-create-input").val()),$(".channel-nav").removeClass("active");var n=$(`<div class="channel-nav ${e.channel_id} active">${$("#name-create-input").val()}</div>`);$("#channel-nav-div").append(n),click_channel_nav(n),$(".friend-box").addClass("disabled"),$("#name-create-input").val(""),$("#btn-channel-delete").attr("href",`/channels/${e.channel_id}`),$(".friend-box-with-edit").hide()}$("#channel-name").show(),$("#channel-default-btns").show(),$("#btn-channel-add").show()}},error:function(){console.log("error!")}})}),$(".btn-friend-remove").on("click",function(){$("#channel-nav-div").hasClass("editing")&&($("#name-create-form").hide(),$("#btn-channel-add").show(),$("#name-edit-form").hide(),$("#channel-name").show()),confirm("\uc815\ub9d0 \uce5c\uad6c\ub97c \ub04a\uc73c\uc2dc\uaca0\uc2b5\ub2c8\uae4c?")&&(form=$(this),$.ajax({type:"POST",url:form.attr("data-url"),data:{from_friend_list:!0},success:function(){console.log("successed!"),form.parents(".friend-box-with-edit").fadeOut(300,function(){$(this).remove()})},error:function(){console.log("error!")}}))});